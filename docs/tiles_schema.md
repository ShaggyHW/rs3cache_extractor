# Tiles Database Schema

The SQLite database `tiles.db` is generated by the loader in `load_tiles.py`. It contains walkable map data along with auxiliary teleport definitions. The schema below reflects the tables created by `create_tables()`.

## `tiles`

| Column | Type | Notes |
| --- | --- | --- |
| `x` | INTEGER | Tile X coordinate. Part of the primary key. |
| `y` | INTEGER | Tile Y coordinate. Part of the primary key. |
| `plane` | INTEGER | Height level (0–3). Part of the primary key. |
| `chunk_x` | INTEGER | Chunk X containing the tile. Foreign key to `chunks.chunk_x`. |
| `chunk_z` | INTEGER | Chunk Z containing the tile. Foreign key to `chunks.chunk_z`. |
| `flag` | INTEGER | Raw flag value from cache data. |
| `blocked` | INTEGER | `1` if the tile blocks movement, else `0`. |
| `walk_mask` | INTEGER | Bitmask describing allowed move directions. |
| `blocked_mask` | INTEGER | Bitmask describing blocked directions. |
| `walk_data` | TEXT | JSON-encoded supplemental walk metadata. |

**Primary Key:** (`x`, `y`, `plane`)

**Foreign Key:** (`chunk_x`, `chunk_z`) → `chunks(chunk_x, chunk_z)`

**Example row (queried):**

| x | y | plane | chunk_x | chunk_z | flag | blocked | walk_mask | blocked_mask | walk_data |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1792 | 11520 | 0 | 28 | 180 | 129 | 1 | 115 | 140 | `{ "left": true, "bottom": true, "right": false, "top": false, "topleft": true, "bottomleft": true, "bottomright": true, "topright": false }` |

## `chunks`

| Column | Type | Notes |
| --- | --- | --- |
| `chunk_x` | INTEGER | Chunk X coordinate. Part of the primary key. |
| `chunk_z` | INTEGER | Chunk Z coordinate. Part of the primary key. |
| `chunk_size` | INTEGER | Side length of the square chunk (tiles). |
| `tile_count` | INTEGER | Number of tiles loaded for the chunk. |

**Primary Key:** (`chunk_x`, `chunk_z`)

**Example row (queried):**

| chunk_x | chunk_z | chunk_size | tile_count |
| --- | --- | --- | --- |
| 28 | 180 | 64 | 16384 |

## `teleports_door_nodes`

| Column | Type |
| --- | --- |
| `id` | INTEGER |
| `direction` | REAL |
| `real_id_open` | INTEGER |
| `real_id_closed` | INTEGER |
| `location_open_x` | INTEGER |
| `location_open_y` | INTEGER |
| `location_open_plane` | INTEGER |
| `location_closed_x` | INTEGER |
| `location_closed_y` | INTEGER |
| `location_closed_plane` | INTEGER |
| `tile_inside_x` | INTEGER |
| `tile_inside_y` | INTEGER |
| `tile_inside_plane` | INTEGER |
| `tile_outside_x` | INTEGER |
| `tile_outside_y` | INTEGER |
| `tile_outside_plane` | INTEGER |
| `open_action` | TEXT |
| `cost` | INTEGER |
| `next_node_type` | REAL |
| `next_node_id` | REAL |
| `requirement_id` | REAL |

**Example row (queried):**

| id | direction | real_id_open | real_id_closed | location_open_x | location_open_y | location_open_plane | location_closed_x | location_closed_y | location_closed_plane | tile_inside_x | tile_inside_y | tile_inside_plane | tile_outside_x | tile_outside_y | tile_outside_plane | open_action | cost | next_node_type | next_node_id | requirement_id |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | NULL | 28693 | 28691 | 2943 | 3440 | 0 | 2942 | 3440 | 0 | 2942 | 3440 | 0 | 2943 | 3440 | 0 | Open | 1 | NULL | NULL | NULL |

## `teleports_ifslot_nodes`

| Column | Type |
| --- | --- |
| `id` | INTEGER |
| `interface_id` | INTEGER |
| `component_id` | INTEGER |
| `slot_id` | INTEGER |
| `click_id` | INTEGER |
| `dest_min_x` | REAL |
| `dest_max_x` | REAL |
| `dest_min_y` | REAL |
| `dest_max_y` | REAL |
| `dest_plane` | REAL |
| `cost` | INTEGER |
| `next_node_type` | TEXT |
| `next_node_id` | REAL |
| `requirement_id` | REAL |


**Example row (queried):**

| id | interface_id | component_id | slot_id | click_id | dest_min_x | dest_max_x | dest_min_y | dest_max_y | dest_plane | cost | next_node_type | next_node_id | requirement_id |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | 1184 | 15 | -1 | 0 | NULL | NULL | NULL | NULL | NULL | 1 | ifslot | 2.0 | NULL |

## `teleports_item_nodes`

| Column | Type |
| --- | --- |
| `id` | INTEGER |
| `item_id` | INTEGER |
| `action` | TEXT |
| `dest_min_x` | INTEGER |
| `dest_max_x` | INTEGER |
| `dest_min_y` | INTEGER |
| `dest_max_y` | INTEGER |
| `dest_plane` | INTEGER |
| `next_node_type` | REAL |
| `next_node_id` | REAL |
| `cost` | INTEGER |
| `requirement_id` | INTEGER |

**Example row (queried):**

| id | item_id | action | dest_min_x | dest_max_x | dest_min_y | dest_max_y | dest_plane | next_node_type | next_node_id | cost | requirement_id |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | 19480 | Read | 3299 | 3309 | 3544 | 3554 | 0 | NULL | NULL | 1 | 29 |

## `teleports_lodestone_nodes`

| Column | Type |
| --- | --- |
| `id` | INTEGER |
| `lodestone` | TEXT |
| `dest_x` | INTEGER |
| `dest_y` | INTEGER |
| `dest_plane` | INTEGER |
| `cost` | INTEGER |
| `next_node_type` | REAL |
| `next_node_id` | REAL |
| `requirement_id` | REAL |

**Example row (queried):**

| id | lodestone | dest_x | dest_y | dest_plane | cost | next_node_type | next_node_id | requirement_id |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 3 | AL_KHARID | 3297 | 3184 | 0 | 1 | NULL | NULL | 3.0 |

## `teleports_npc_nodes`

| Column | Type |
| --- | --- |
| `id` | INTEGER |
| `match_type` | TEXT |
| `npc_id` | INTEGER |
| `npc_name` | REAL |
| `action` | TEXT |
| `dest_min_x` | REAL |
| `dest_max_x` | REAL |
| `dest_min_y` | REAL |
| `dest_max_y` | REAL |
| `dest_plane` | INTEGER |
| `search_radius` | INTEGER |
| `cost` | INTEGER |
| `orig_min_x` | REAL |
| `orig_max_x` | REAL |
| `orig_min_y` | REAL |
| `orig_max_y` | REAL |
| `orig_plane` | INTEGER |
| `next_node_type` | TEXT |
| `next_node_id` | INTEGER |
| `requirement_id` | INTEGER |

**Example row (queried):**

| id | match_type | npc_id | npc_name | action | dest_min_x | dest_max_x | dest_min_y | dest_max_y | dest_plane | search_radius | cost | orig_min_x | orig_max_x | orig_min_y | orig_max_y | orig_plane | next_node_type | next_node_id | requirement_id |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 376 | NULL | Pay fare | 2953.0 | 2960.0 | 3146.0 | 3147.0 | 0 | 20 | 1 | 3024.0 | 3029.0 | 3212.0 | 3225.0 | 0 | ifslot | 1 | 1 |

## `teleports_object_nodes`

| Column | Type |
| --- | --- |
| `id` | INTEGER |
| `match_type` | TEXT |
| `object_id` | REAL |
| `object_name` | TEXT |
| `action` | TEXT |
| `dest_min_x` | INTEGER |
| `dest_max_x` | INTEGER |
| `dest_min_y` | INTEGER |
| `dest_max_y` | INTEGER |
| `dest_plane` | INTEGER |
| `orig_min_x` | INTEGER |
| `orig_max_x` | INTEGER |
| `orig_min_y` | INTEGER |
| `orig_max_y` | INTEGER |
| `orig_plane` | INTEGER |
| `search_radius` | INTEGER |
| `cost` | INTEGER |
| `next_node_type` | TEXT |
| `next_node_id` | REAL |
| `requirement_id` | REAL |

**Example row (queried):**

| id | match_type | object_id | object_name | action | dest_min_x | dest_max_x | dest_min_y | dest_max_y | dest_plane | orig_min_x | orig_max_x | orig_min_y | orig_max_y | orig_plane | search_radius | cost | next_node_type | next_node_id | requirement_id |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | name | NULL | Ladder | Climb-down | 3017 | 3022 | 9737 | 9741 | 0 | 3017 | 3021 | 3337 | 3341 | 0 | 20 | 600 | NULL | NULL | 30.0 |

## `teleports_requirements`

| Column | Type |
| --- | --- |
| `id` | INTEGER |
| `metaInfo` | TEXT |
| `key` | TEXT |
| `value` | REAL |
| `comparison` | TEXT |

**Example row (queried):**

| id | metaInfo | key | value | comparison |
| --- | --- | --- | --- | --- |
| 1 | moneypouch | coins | 30.0 | >= |
